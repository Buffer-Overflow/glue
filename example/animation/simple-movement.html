<!DOCTYPE HTML>
<html>
<head>
    <title>Simple movement</title>
    <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <style>
        #canvas {
            border: 1px solid #00aa00;
        }
    </style>
    <script src="../../build/glue.min.js"></script>
    <script>
        glue.module.get(
            [
                'glue/game',
                'glue/component/visible'
            ],
            function (Game, VisibleComponent) {
                'use strict';

                Game.setup({
                    canvas: {
                        id: 'canvas',
                        dimension: {
                            width: 800,
                            height: 600
                        }
                    }
                }, function () {
                    var component = VisibleComponent();
                    component.visible.setup({
                        position: {
                            x: 0,
                            y: 0
                        },
                        dimension: {
                            width: 125,
                            height: 92
                        },
                        image: {
                            src: '../image/glue-logo.png',
                            width: 200,
                            height: 100,
                            frameWidth: 100
                        }
                    }).then(function () {
                        var canvasDimension = Game.canvas.getDimension(),
                            playerDimension,
                            playerPosition,
                            speed = 1,
                            direction = 'right';

                        component.mix({
                            update: function (deltaT) {
                                //console.log('updating', deltaT);
                                this.visible.update(deltaT);
                                playerDimension = this.visible.getDimension();
                                playerPosition = this.visible.getPosition();
                                //console.log(playerPosition.x,
                                //    canvasDimension.width, playerDimension.width);
                                if (playerPosition.x > canvasDimension.width -
                                        playerDimension.width) {
                                    direction = 'down';
                                }
                                if (playerPosition.y > canvasDimension.height -
                                        playerDimension.height) {
                                    direction = 'left';
                                }
                                if (playerPosition.x < 0) {
                                    direction = 'up';
                                }
                                if (playerPosition.y < 0) {
                                    playerPosition.y = 0;
                                    direction = 'right';
                                }
                                switch (direction) {
                                    case 'right':
                                        playerPosition.x += speed;
                                    break;
                                    case 'down':
                                        playerPosition.y += speed;
                                    break;
                                    case 'left':
                                        playerPosition.x -= speed;
                                    break;
                                    case 'up':
                                        playerPosition.y -= speed;
                                    break;
                                }
                            },
                            draw: function (deltaT, context) {
                                this.visible.draw(deltaT, context);
                            },
                            pointerDown: function (e) {
                                console.log('Pointer down: ', e.position);
                            },
                            pointerMove: function (e) {
                                console.log('Pointer move: ', e.position);
                            },
                            pointerUp: function (e) {
                                console.log('Pointer up: ', e.position);
                            }
                        });
                    });
                    Game.add(component);
                });
            }
        );
    </script>
</head>
<body>
</body>
</html>
